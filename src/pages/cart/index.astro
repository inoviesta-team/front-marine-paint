---
import MarineLayout from "@layouts/MarineLayout.astro";
import MarineHeader from "@components/layout/MarineHeader";
import MarineFooter from "@components/layout/MarineFooter";
import MarineButton from "@components/ui/MarineButton";
import FloatingWhatsAppButton from "@components/ui/FloatingWhatsAppButton";
import { useCart } from "@hooks/useCart";
import MainLayout from "@layouts/MainLayout.astro";

// Sample cart data (in production, this would come from your cart context/state)
const sampleCartItems = [
  {
    id: "1",
    name: "Anti-fouling 300",
    price: 126000,
    quantity: 1,
    image: "https://down-id.img.susercontent.com/file/id-11134207-7r98y-lvobtdwybblw56",
  },
  {
    id: "2",
    name: "Epoxy Primer EP-200",
    price: 150000,
    quantity: 1,
    image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSGjBbJzoux06gqvfWyytNqCfcrUTfiqkhrVQ&s",
  },
  {
    id: "3",
    name: "Topcoat TC-100",
    price: 175000,
    quantity: 1,
    image: "https://www.promarinetrade.com/cache/promarine/public/shop_product_picture/_1200x800x0/7397_MARINE_GLOSS_1L.jpg",
  },
];

// Calculate cart totals
const subtotal = sampleCartItems.reduce((total, item) => total + (item.price * item.quantity), 0);
const discount = 50000; // Sample discount
const deliveryFee = 15000; // Sample delivery fee
const total = subtotal - discount + deliveryFee;
---

<MainLayout
  title="Shopping Cart | Toko Koko Lie"
  description="View and manage your shopping cart items"
>
  <main class="bg-gray-50 py-6">
    <div class="container mx-auto py-8 px-4 md:px-14">
      <div class="mb-8">
        <h1 class="font-sans font-bold text-marine-darkBlue text-3xl">Keranjang Belanja Anda</h1>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2">
          <div class="bg-white rounded-xl shadow-sm overflow-hidden">
            <div class="grid grid-cols-12 gap-4 py-4 px-6 border-b border-gray-200 bg-gray-50">
              <div class="col-span-6 font-sans font-bold text-marine-darkBlue">Produk</div>
              <div class="col-span-2 font-sans font-bold text-marine-darkBlue text-center">Harga</div>
              <div class="col-span-2 font-sans font-bold text-marine-darkBlue text-center">Jumlah</div>
              <div class="col-span-2 font-sans font-bold text-marine-darkBlue text-right">Total</div>
            </div>
            
            {sampleCartItems.length > 0 ? (
              <div>
                {sampleCartItems.map((item) => (
                  <div class="grid grid-cols-12 gap-4 py-4 px-6 border-b border-gray-100 items-center">
                    <div class="col-span-6">
                      <div class="flex items-center">
                        <div class="w-16 h-16 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0">
                          <img 
                            src={item.image} 
                            alt={item.name} 
                            class="w-full h-full object-cover"
                          />
                        </div>
                        <div class="ml-4">
                          <h3 class="font-sans font-bold text-marine-darkBlue">
                            {item.name}
                          </h3>
                          <button 
                            class="font-sans text-sm text-red-500 hover:text-red-700 flex items-center mt-1"
                          >
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1">
                              <path d="M3 6h18"></path>
                              <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                              <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                            </svg>
                            Hapus
                          </button>
                        </div>
                      </div>
                    </div>
                    
                    <div class="col-span-2 font-sans text-gray-700 text-center">
                      Rp{item.price.toLocaleString()}
                    </div>
                    
                    <div class="col-span-2 flex justify-center">
                      <div class="inline-flex items-center">
                        <button 
                          class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center border border-gray-200 text-gray-600 hover:bg-gray-200 transition-colors"
                        >
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M5 12h14"></path>
                          </svg>
                        </button>
                        <span class="mx-3 w-6 text-center font-sans font-medium text-gray-700">
                          {item.quantity}
                        </span>
                        <button 
                          class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center border border-gray-200 text-gray-600 hover:bg-gray-200 transition-colors"
                        >
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 5v14"></path>
                            <path d="M5 12h14"></path>
                          </svg>
                        </button>
                      </div>
                    </div>
                    
                    <div class="col-span-2 font-sans font-bold text-marine-darkBlue text-right">
                      Rp{(item.price * item.quantity).toLocaleString()}
                    </div>
                  </div>
                ))}
              </div>
            ) : (
              <div class="py-12 px-6 text-center">
                <div class="mb-6">
                  <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-gray-400">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                  </svg>
                </div>
                <h3 class="font-sans font-bold text-marine-darkBlue text-xl mb-2">Keranjang Anda kosong</h3>
                <p class="font-sans text-gray-600 mb-6">Sepertinya Anda belum menambahkan produk apa pun.</p>
                <MarineButton
                  as="a" 
                  href="/products" 
                  variant="primary"
                  size="md"
                  client:load
                >
                  Jelajahi Produk
                </MarineButton>
              </div>
            )}
            
            <div class="py-4 px-6 border-t border-gray-200 flex flex-wrap gap-4 justify-between items-center bg-gray-50">
              <div class="flex items-center">
                <input 
                  type="text" 
                  placeholder="Kode Kupon" 
                  class="w-48 h-10 border border-gray-300 rounded-lg px-4 font-sans text-sm focus:outline-none focus:ring-2 focus:ring-marine-blue"
                />
                <button class="ml-2 h-10 px-4 bg-marine-blue text-white rounded-lg font-sans font-bold hover:bg-marine-darkBlue transition-colors">
                  Terapkan
                </button>
              </div>
              
              <button class="h-10 px-4 bg-white border border-gray-300 text-marine-darkBlue rounded-lg font-sans hover:bg-gray-100 transition-colors flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
                Perbarui Keranjang
              </button>
            </div>
          </div>
        </div>
        
        <div class="lg:col-span-1">
          <div class="bg-white rounded-xl shadow-sm overflow-hidden">
            <div class="py-4 px-6 border-b border-gray-200 bg-gray-50">
              <h2 class="font-sans font-bold text-marine-darkBlue text-lg">Ringkasan Pesanan</h2>
            </div>
            
            <div class="p-6">
              <div class="flex justify-between mb-3">
                <span class="font-sans text-gray-600">Subtotal</span>
                <span class="font-sans font-medium text-marine-darkBlue">Rp{subtotal.toLocaleString()}</span>
              </div>
              
              <div class="flex justify-between mb-3">
                <span class="font-sans text-gray-600">Diskon (10%)</span>
                <span class="font-sans font-medium text-green-600">-Rp{discount.toLocaleString()}</span>
              </div>
              
              <div class="flex justify-between mb-4">
                <span class="font-sans text-gray-600">Biaya Pengiriman</span>
                <span class="font-sans font-medium text-marine-darkBlue">Rp{deliveryFee.toLocaleString()}</span>
              </div>
              
              <div class="border-t border-gray-200 my-4"></div>
              
              <div class="flex justify-between mb-6">
                <span class="font-sans font-bold text-marine-darkBlue">Total</span>
                <span class="font-sans font-bold text-marine-darkBlue text-xl">Rp{total.toLocaleString()}</span>
              </div>
              
              <MarineButton 
                variant="primary"
                size="lg"
                className="w-full justify-center shadow-md hover:shadow-lg"
                client:load
              >
                Checkout
              </MarineButton>
              
              <div class="mt-4 text-center">
                <a href="/products" class="font-sans text-marine-blue hover:text-marine-darkBlue inline-flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                    <path d="M19 12H5"></path>
                    <path d="M12 19l-7-7 7-7"></path>
                  </svg>
                  Lanjutkan Belanja
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <FloatingWhatsAppButton client:load />
</MainLayout>

<script>
  // Cart functionality would typically be handled by a client-side React component
  // This is a simplified version to demonstrate the interactions
  
  document.addEventListener('DOMContentLoaded', () => {
    // Quantity increase/decrease buttons
    const decrementButtons = document.querySelectorAll('button:has(svg path[d="M5 12h14"])');
    const incrementButtons = document.querySelectorAll('button:has(svg path[d="M12 5v14"])');
    
    decrementButtons.forEach(button => {
      button.addEventListener('click', () => {
        const quantityElement = button.nextElementSibling;
        let quantity = parseInt(quantityElement.textContent.trim(), 10);
        if (quantity > 1) {
          quantity--;
          quantityElement.textContent = quantity;
          // In a real app, you would update the cart state and recalculate totals here
        }
      });
    });
    
    incrementButtons.forEach(button => {
      button.addEventListener('click', () => {
        const quantityElement = button.previousElementSibling;
        let quantity = parseInt(quantityElement.textContent.trim(), 10);
        quantity++;
        quantityElement.textContent = quantity;
        // In a real app, you would update the cart state and recalculate totals here
      });
    });
    
    // Remove buttons
    const removeButtons = document.querySelectorAll('button:has(svg path[d="M3 6h18"])');
    removeButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        // Find the parent cart item and remove it
        const cartItem = e.currentTarget.closest('.grid.grid-cols-12.gap-4.py-4');
        if (cartItem) {
          cartItem.remove();
          // In a real app, you would update the cart state and recalculate totals here
        }
      });
    });
  });
</script>